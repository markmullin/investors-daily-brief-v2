@echo off
echo ðŸš€ Starting Enhanced Market Dashboard with AI Fixes
echo =====================================================
echo.

REM Check if we're in the right directory
if not exist "backend" (
    echo âŒ Error: Please run this script from the root directory (investors-daily-brief)
    echo Current directory: %CD%
    echo Expected structure: investors-daily-brief\backend and investors-daily-brief\frontend
    pause
    exit /b 1
)

echo ðŸ“ Current directory: %CD%
echo.

REM Install dependencies if needed
echo ðŸ”§ Checking backend dependencies...
cd backend
if not exist "node_modules" (
    echo ðŸ“¦ Installing backend dependencies...
    npm install
    if errorlevel 1 (
        echo âŒ Backend dependency installation failed
        pause
        exit /b 1
    )
) else (
    echo âœ… Backend dependencies already installed
)

REM Start backend server
echo.
echo ðŸŒ Starting backend server with enhanced AI routes...
echo    - Enhanced AI Analysis endpoints
echo    - Real current events from Bloomberg/CNBC/Barrons
echo    - TypewriterText for Sector and Macro analysis
echo.

start "Market Dashboard Backend" cmd /k "echo ðŸ¤– Backend Server Starting... && node server.js"

REM Wait a moment for backend to start
echo â³ Waiting for backend to initialize...
timeout /t 5 /nobreak >nul

REM Start frontend
echo.
echo ðŸŽ¨ Starting frontend...
cd ..\frontend

if not exist "node_modules" (
    echo ðŸ“¦ Installing frontend dependencies...
    npm install
    if errorlevel 1 (
        echo âŒ Frontend dependency installation failed
        pause
        exit /b 1
    )
) else (
    echo âœ… Frontend dependencies already installed
)

echo.
echo ðŸ–¥ï¸ Opening frontend development server...
start "Market Dashboard Frontend" cmd /k "echo ðŸŽ¨ Frontend Server Starting... && npm run dev"

REM Wait and open browser
echo.
echo â³ Waiting for servers to fully start...
timeout /t 8 /nobreak >nul

echo.
echo ðŸŒ Opening Market Dashboard in browser...
start http://localhost:5173

echo.
echo âœ… STARTUP COMPLETE!
echo ===================
echo.
echo ðŸ–¥ï¸ Frontend: http://localhost:5173
echo ðŸŒ Backend:  http://localhost:5000
echo.
echo ðŸŽ¯ WHAT TO TEST:
echo âœ“ Daily Market Brief - Should show real current events with TypewriterText
echo âœ“ Sector Analysis - Should show AI analysis with TypewriterText effect
echo âœ“ Macro Analysis - Should show AI analysis with TypewriterText effect  
echo âœ“ Key Relationships - Should continue working as before
echo.
echo ðŸ“Š Check the console logs in both terminal windows for detailed information
echo ðŸ” Look for "Enhanced Analysis" or "AI Generated" badges in the UI
echo.
echo Press any key to run backend tests...
pause >nul

REM Run backend tests
echo.
echo ðŸ§ª Running Enhanced AI Tests...
cd ..\backend
node test-enhanced-ai-fixes.js

echo.
echo ðŸŽ‰ All done! Your Market Dashboard is now running with enhanced AI analysis.
echo Press any key to exit...
pause >nul